{% load budget static %}

<!DOCTYPE html>
<link rel="stylesheet" href="{% static 'budget/style.css' %}">
<script src="{% static 'budget/jdecimal.js' %}"></script>
<script src="{% static 'budget/util.js' %}"></script>
<script src="{% static 'budget/account.js' %}"></script>

<div><a href="{% url 'overview' account.budget.id %}">Overview</a></div>

<div>
    {% if form %}
    <form method="post">
        {% csrf_token %}
        {{ form.name }}
        {% if form.currency %}
        {{ form.currency }}
        <button>Save</button>
        {% else %}
        <button>Rename</button>
        {% endif %}
    </form>
    <datalist id="currencies">
        <option value="USD">
        <option value="EUR">
        <option value="JPY">
        <option value="GBP">
        <option value="AUD">
        <option value="CHF">
        <option value="CNH">
        <option value="INR">
    </datalist>
    {% else %}
    {% account_in_budget account account.budget %}
    {% endif %}
</div>
<div><button type="button" id="new">Add transaction</button></div>
{% spaceless %}
<table id="table">
    <th class="t6">Date</th>
    <th class="t9">Description</th>
    <th class="t4">{{ account.currency }}</th>
    <th class="t4">Total</th>
    {% for transaction in entries %}
    <tr class="{% cycle 'a' 'b' as rowcolor %}" tabindex="0" data-id="{{transaction.id}}">
        <td>{{transaction.date}}</td>
        <td>{{transaction|transaction_description:account}}</td>
        <td class="number shortcurrency" data-currency="{{ account.currency }}">{{transaction.change}}</td>
        <td>
            <div class="detail-container">
                <div class="transaction-detail">
                    {% if transaction.kind != 'B' %}
                    <span class="line">──┐</span>
                    <table class="transaction-detail-table">
                        <th class="t6">Account</th>
                        <th class="t6">Category</th>
                        <th class="t4">Amount</th>
                        <th class="t4">Note</th>
                        {% for part in transaction.tabular %}
                        <tr class="{% cycle 'a' 'b' %}">
                            <td>{% account_in_budget part.account account.budget %}</td>
                            <td>{% account_in_budget part.category account.budget %}</td>
                            {% firstof part.account.currency part.category.currency as currency %}
                            <td class="number {% if currency == account.currency %}shortcurrency{% endif %}" data-currency="{{ currency }}">{{part.amount}}</td>
                            <td>{{part.note}}</td>
                        </tr>
                        {% endfor %}
                        {% resetcycle %}
                    </table>
                    {% endif %}
                    <div class="transaction-detail-edit"><a href="{% url 'edit' account.budget.id transaction.id %}?back={{ request.get_full_path|urlencode }}">Edit...</a></div>
                </div>
            </div>
            <div class="number shortcurrency" data-currency="{{ account.currency }}">{{transaction.running_sum}}</div>
        </td>
    </tr>
    {% endfor %}
</table>
{{ data|json_script:"data" }}
{% endspaceless %}
