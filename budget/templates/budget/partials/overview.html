<div class="controls"><div class="tools">
    <a href="{{ url('manage', budget.id) }}">Manage...</a>
    <a href="{{ url('budget', budget.id, today.year, today.month) }}">Budget...</a>
</div></div>
{% set checked = account and account.id %}
<entry-list
    class="scroll"
    name="account"
    {% if not account %}autofocus{% endif %}
    hx-trigger="kbdselect,mouseselect delay:100ms"
    hx-get="{{ url('all', budget.id) }}"
    hx-target="#account"
    hx-select-oob="#transaction">
    <table id="categories">
        <tr>
            <th>Category</th>
            <th class="t5">Balance</th>
        </tr>
        {% set rowclass = cycler('a', 'b') %}
        {% for row in categories %}
        {% if row in groups %}
        <tr class="{{ rowclass.next() }}">
            <th>{{ row.group or "&nbsp;" }}</th>
            <th class="number">
                {% for currency, amounts in groups[row].items() if amounts|length > 1%}
                <long-currency currency="{{ currency }}" value="{{ amounts|sum }}"></long-currency>
                {% if not loop.last %}<br>{% endif %}
                {% endfor %}
            </th>
        </tr>
        {% endif %}
        <tr class="{{ rowclass.next() }} {% if row.id == checked %}checked{% endif %}"
        data-value="{{row.id}}">
            <td>{{ row.name or "Inbox" }}</td>
            <td class="number">
                <long-currency currency="{{ row.currency }}" value="{{ row.balance or 0 }}"></long-currency>
            </td>
        </tr>
        {% endfor %}
        <tr><th colspan="2">&nbsp;</th></tr>
        <tr>
            <th>Account</th>
            <th class="t5">Balance</th>
        </tr>
        {% for row in accounts %}
        <tr class="{{ rowclass.next() }} {% if row.id == checked %}checked{% endif %}" data-value="{{row.id}}">
            <td>{{ row.name or "Inbox" }}</td>
            <td class="number"> <long-currency currency="{{ row.currency }}" value="{{ row.balance or 0 }}"></long-currency></td>
        </tr>
        {% endfor %}
        {% for row in debts %}
        <tr class="{{ rowclass.next() }} {% if row.id == checked %}checked{% endif %}" data-value="{{ row.id }}">
            <td>Owed by {{ row.other }}</td>
            <td class="number">
                <long-currency currency="{{ row.currency }}" value="{{ row.other.balance }}"></long-currency>
            </td>
        </tr>
        {% endfor %}
        <tr><th colspan="2">&nbsp;</th></tr>
        <tr>
            <th>Total</th>
            <th class="t5">Balance</th>
        </tr>
        {% for row in totals %}
        <tr class="{{ rowclass.next() }} {% if row.id == checked %}checked{% endif %}" data-value="{{ row.id }}">
            <td>Total</td>
            <td class="number">
                <long-currency currency="{{ row.currency }}" value="{{ row.balance }}"></long-currency>
            </td>
        </tr>
        {% endfor %}
    </table>
    <template id="new-group-t">
        <tr id="new-group" data-category="1">
            <th colspan="2">New Group</th>
        </tr>
    </template>
</entry-list>
