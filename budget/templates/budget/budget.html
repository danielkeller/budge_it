{% load budget static %}

<!DOCTYPE html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{% static 'budget/style.css' %}">
    <script src="{% static 'budget/util.js' %}"></script>
    <script src="{% static 'budget/jdecimal.js' %}"></script>
    <script src="{% static 'budget/editor.js' %}"></script>
    <script src="{% static 'budget/budget.js' %}"></script>
    <script src="{% static 'budget/htmx.min.js' %}" defer></script>
</head>
<body class="popup">
    <div class="controls">
        <div class="navigation">
            <div><a href="{{ budget.get_absolute_url }}">Back</a></div>
        </div>
        <div class="tools">
            {% if prior and not form.instance.id %}
            <form method="post" action="{% url 'copy_budget' budget.id prior.id current_year current_month  %}">
                {% csrf_token %}
                <div>
                    <button>Copy from {{ prior.date|date:"M Y" }}</button>
                    <button form="form">Save</button>
                </div>
            </form>
            {% endif %}
            <button form="form">Save</button>
        </div>
    </div>

    <main class="manage">
        <form id="datepicker" is="date-picker">
            <div class="datepicker">
                <div class="years">
                    {% for year in years %}
                    <input type="radio" name="year" id="year{{ year }}" value="{{ year }}"
                        {% if year == current_year %}checked{% endif %}>
                    <label for="year{{ year }}">{{ year }}</label>
                    {% endfor %}
                </div>
                <div class="months">
                    {% for month in months %}
                    <a href="{% url 'budget' budget.id month.year month.month %}"
                        {% if month.month == current_month %}class="current" {% endif %}>
                        {{ month|date:"M" }}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </form>

        <form id="form" method="post" is="budget-form">
            <table id="table">
                <tr>
                    <th>Category</th>
                    <th>{{ budget_date|date:"M d" }}</th>
                    <th class="t4">Budgeted</th>
                    <th>Spent</th>
                    <th>{{ end_date|date:"M d" }}</th>
                </tr>
                {% for row in rows %}
                {% ifchanged row.category.group %}
                <tr class=" {% cycle 'a' 'b' as rowcolor %}">
                    <th>{{row.category.group|default:"&nbsp;"}}</th>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                {% endifchanged %}
                <tr class="{% cycle rowcolor %}">
                    <td>{% account_in_budget row.category budget %}</td>
                    <td class="number">
                        <long-currency currency="{{ row.category.currency }}" value="{{ row.category.balance }}"></long-currency>
                    </td>
                    <td class="tdinput">
                        {% if row.category.name == '' %}
                        <span is="standalone-currency-input" currency="{{ row.category.currency }}" data-budget-inbox>
                            {{ row.field }}<input class="suggested number" readonly>
                        </span>
                        {% else %}
                        <span is="standalone-currency-input" currency="{{ row.category.currency }}" data-budget-category>
                            {{ row.field }}<input class="number">
                        </span>
                        {% endif %}
                    </td>
                    <td class="number">
                        <short-currency currency="{{ row.category.currency }}" value="{{ row.category.change }}"></short-currency>
                    </td>
                    <td class="number">
                        <short-currency currency="{{ row.category.currency }}" value="{{ row.final }}" data-total="{{ row.total }}"></short-currency>
                    </td>
                </tr>
                {% endfor %}
            </table>
            {% csrf_token %}
            {{ form.date }}
        </form>
    </main>
    {{ data|json_script:"data" }}
    {{ form.errors|default:"" }}
</body>